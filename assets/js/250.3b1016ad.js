(window.webpackJsonp=window.webpackJsonp||[]).push([[250],{698:function(a,o,e){"use strict";e.r(o);var t=e(1),s=Object(t.a)({},(function(){var a=this,o=a._self._c;return o("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[o("h1",{attrs:{id:"automated-upgrades"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#automated-upgrades"}},[a._v("#")]),a._v(" Automated Upgrades")]),a._v(" "),o("p",{attrs:{synopsis:""}},[a._v("Learn how to automate chain upgrades using Cosmovisor.")]),a._v(" "),o("h2",{attrs:{id:"pre-requisites"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#pre-requisites"}},[a._v("#")]),a._v(" Pre-requisites")]),a._v(" "),o("ul",[o("li",{attrs:{prereq:""}},[o("a",{attrs:{href:"https://docs.cosmos.network/main/run-node/cosmovisor.html#installation",target:"_blank",rel:"noopener noreferrer"}},[a._v("Install Cosmovisor"),o("OutboundLink")],1)])]),a._v(" "),o("h2",{attrs:{id:"using-cosmovisor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#using-cosmovisor"}},[a._v("#")]),a._v(" Using Cosmovisor")]),a._v(" "),o("blockquote",[o("p",[o("code",[a._v("cosmovisor")]),a._v(" is a small process manager for Cosmos SDK application binaries that monitors the governance module for incoming chain upgrade proposals. If it sees a proposal that gets approved, cosmovisor can automatically download the new binary, stop the current binary, switch from the old binary to the new one, and finally restart the node with the new binary.")])]),a._v(" "),o("div",{staticClass:"custom-block tip"},[o("p",[a._v("ðŸ‘‰ For more info about Cosmovisor, please refer to the project official documentation "),o("a",{attrs:{href:"https://docs.cosmos.network/main/run-node/cosmovisor.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("here"),o("OutboundLink")],1),a._v(".")])]),a._v(" "),o("p",[a._v("We highly recommend validators use Cosmovisor to run their nodes. This will make low-downtime upgrades smoother, as validators don't have to "),o("RouterLink",{attrs:{to:"/validators/upgrades/manual.html"}},[a._v("manually upgrade")]),a._v(" binaries during the upgrade. Instead users can "),o("a",{attrs:{href:"#manual-download"}},[a._v("pre-install")]),a._v(" new binaries, and Cosmovisor will automatically update them based on on-chain Software Upgrade proposals.")],1),a._v(" "),o("h3",{attrs:{id:"_1-setup-cosmovisor"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_1-setup-cosmovisor"}},[a._v("#")]),a._v(" 1. Setup Cosmovisor")]),a._v(" "),o("p",[a._v("Set up the Cosmovisor environment variables. We recommend setting these in your "),o("code",[a._v(".profile")]),a._v(" so it is automatically set in every session.")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"ZWNobyAmcXVvdDsjIFNldHVwIENvc21vdmlzb3ImcXVvdDsgJmd0OyZndDsgfi8ucHJvZmlsZQplY2hvICZxdW90O2V4cG9ydCBEQUVNT05fTkFNRT1wbGFucWQmcXVvdDsgJmd0OyZndDsgfi8ucHJvZmlsZQplY2hvICZxdW90O2V4cG9ydCBEQUVNT05fSE9NRT0kSE9NRS8ucGxhbnFkJnF1b3Q7ICZndDsmZ3Q7IH4vLnByb2ZpbGUKc291cmNlIH4vLnByb2ZpbGUK"}}),a._v(" "),o("p",[a._v("After this, you must make the necessary folders for "),o("code",[a._v("cosmosvisor")]),a._v(" in your "),o("code",[a._v("DAEMON_HOME")]),a._v(" directory ("),o("code",[a._v("~/.planqd")]),a._v(") and copy over the current binary.")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"bWtkaXIgLXAgfi8ucGxhbnFkL2Nvc21vdmlzb3IKbWtkaXIgLXAgfi8ucGxhbnFkL2Nvc21vdmlzb3IvZ2VuZXNpcwpta2RpciAtcCB+Ly5wbGFucWQvY29zbW92aXNvci9nZW5lc2lzL2Jpbgpta2RpciAtcCB+Ly5wbGFucWQvY29zbW92aXNvci91cGdyYWRlcwoKY3AgJEdPUEFUSC9iaW4vcGxhbnFkIH4vLnBsYW5xZC9jb3Ntb3Zpc29yL2dlbmVzaXMvYmluCg=="}}),a._v(" "),o("p",[a._v("To check that you did this correctly, ensure your versions of "),o("code",[a._v("cosmovisor")]),a._v(" and "),o("code",[a._v("planqd")]),a._v(" are the same:")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"Y29zbW92aXNvciBydW4gdmVyc2lvbgpwbGFucWQgdmVyc2lvbgo="}}),a._v(" "),o("h3",{attrs:{id:"_2-download-the-planq-release"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2-download-the-planq-release"}},[a._v("#")]),a._v(" 2. Download the Planq release")]),a._v(" "),o("h4",{attrs:{id:"_2-a-manual-download"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2-a-manual-download"}},[a._v("#")]),a._v(" 2.a) Manual Download")]),a._v(" "),o("p",[a._v("Cosmovisor will continually poll the "),o("code",[a._v("$DAEMON_HOME/data/upgrade-info.json")]),a._v(" for new upgrade instructions. When an upgrade is "),o("a",{attrs:{href:"https://github.com/planq-network/planq/releases",target:"_blank",rel:"noopener noreferrer"}},[a._v("released"),o("OutboundLink")],1),a._v(", node operators need to:")]),a._v(" "),o("ol",[o("li",[a._v("Download ("),o("strong",[a._v("NOT INSTALL")]),a._v(") the binary for the new release")]),a._v(" "),o("li",[a._v("Place it under "),o("code",[a._v("$DAEMON_HOME/cosmovisor/upgrades/<name>/bin")]),a._v(", where "),o("code",[a._v("<name>")]),a._v(" is the URI-encoded name of the upgrade as specified in the Software Upgrade Plan.")])]),a._v(" "),o("p",[o("strong",[a._v("Example")]),a._v(": for a "),o("code",[a._v("Plan")]),a._v(" with name "),o("code",[a._v("v3.0.0")]),a._v(" with the following "),o("code",[a._v("upgrade-info.json")]),a._v(":")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"json",base64:"ewogICAgJnF1b3Q7YmluYXJpZXMmcXVvdDs6IHsKICAgICAgICAmcXVvdDtkYXJ3aW4vYXJtNjQmcXVvdDs6ICZxdW90O2h0dHBzOi8vZ2l0aHViLmNvbS9wbGFucS1uZXR3b3JrL3BsYW5xL3JlbGVhc2VzL2Rvd25sb2FkL3YzLjAuMC9ldm1vc18zLjAuMF9EYXJ3aW5fYXJtNjQudGFyLmd6JnF1b3Q7LAogICAgICAgICZxdW90O2Rhcndpbi94ODZfNjQmcXVvdDs6ICZxdW90O2h0dHBzOi8vZ2l0aHViLmNvbS9wbGFucS1uZXR3b3JrL3BsYW5xL3JlbGVhc2VzL2Rvd25sb2FkL3YzLjAuMC9ldm1vc18zLjAuMF9EYXJ3aW5feDg2XzY0LnRhci5neiZxdW90OywKICAgICAgICAmcXVvdDtsaW51eC9hcm02NCZxdW90OzogJnF1b3Q7aHR0cHM6Ly9naXRodWIuY29tL3BsYW5xLW5ldHdvcmsvcGxhbnEvcmVsZWFzZXMvZG93bmxvYWQvdjMuMC4wL2V2bW9zXzMuMC4wX0xpbnV4X2FybTY0LnRhci5neiZxdW90OywKICAgICAgICAmcXVvdDtsaW51eC9hbWQ2NCZxdW90OzogJnF1b3Q7aHR0cHM6Ly9naXRodWIuY29tL3BsYW5xLW5ldHdvcmsvcGxhbnEvcmVsZWFzZXMvZG93bmxvYWQvdjMuMC4wL2V2bW9zXzMuMC4wX0xpbnV4X2FtZDY0LnRhci5neiZxdW90OywKICAgICAgICAmcXVvdDt3aW5kb3dzL3g4Nl82NCZxdW90OzogJnF1b3Q7aHR0cHM6Ly9naXRodWIuY29tL3BsYW5xLW5ldHdvcmsvcGxhbnEvcmVsZWFzZXMvZG93bmxvYWQvdjMuMC4wL2V2bW9zXzMuMC4wX1dpbmRvd3NfeDg2XzY0LnppcCZxdW90OwogICAgfQp9Cg=="}}),a._v(" "),o("p",[a._v("Your "),o("code",[a._v("cosmovisor/")]),a._v(" directory should look like this:")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"shell",base64:"Y29zbW92aXNvci8K4pSc4pSA4pSAIGN1cnJlbnQvICAgIyBlaXRoZXIgZ2VuZXNpcyBvciB1cGdyYWRlcy8mbHQ7bmFtZSZndDsK4pSc4pSA4pSAIGdlbmVzaXMK4pSCICAg4pSU4pSA4pSAIGJpbgrilIIgICAgICAg4pSU4pSA4pSAIHBsYW5xZArilJTilIDilIAgdXBncmFkZXMKICAgIOKUlOKUgOKUgCB2My4wLjAKICAgICAgICDilJzilIDilIAgYmluCiAgICAgICAg4pSCICAg4pSU4pSA4pSAIHBsYW5xZAogICAgICAgIOKUlOKUgOKUgCB1cGdyYWRlLWluZm8uanNvbgo="}}),a._v(" "),o("h4",{attrs:{id:"_2-b-automatic-download"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_2-b-automatic-download"}},[a._v("#")]),a._v(" 2.b) Automatic Download")]),a._v(" "),o("div",{staticClass:"custom-block warning"},[o("p",[o("strong",[a._v("NOTE")]),a._v(": Auto-download doesn't verify in advance if a binary is available. If there will be any issue with downloading a binary, "),o("code",[a._v("cosmovisor")]),a._v(" will stop and won't restart an the chain (which could lead it to a halt).")])]),a._v(" "),o("p",[a._v("It is possible to have Cosmovisor "),o("a",{attrs:{href:"https://docs.cosmos.network/main/run-node/cosmovisor.html#auto-download",target:"_blank",rel:"noopener noreferrer"}},[a._v("automatically download"),o("OutboundLink")],1),a._v(" the new binary. Validators can use the automatic download option to prevent unnecessary downtime during the upgrade process. This option will automatically restart the chain with the upgrade binary once the chain has halted at the proposed "),o("code",[a._v("upgrade-height")]),a._v(". The major benefit of this option is that validators can prepare the upgrade binary in advance and then relax at the time of the upgrade.")]),a._v(" "),o("p",[a._v("To set the auto-download use set the following environment variable:")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"ZWNobyAmcXVvdDtleHBvcnQgREFFTU9OX0FMTE9XX0RPV05MT0FEX0JJTkFSSUVTPXRydWUmcXVvdDsgJmd0OyZndDsgfi8ucHJvZmlsZQo="}}),a._v(" "),o("h3",{attrs:{id:"_3-start-your-node"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#_3-start-your-node"}},[a._v("#")]),a._v(" 3. Start your node")]),a._v(" "),o("p",[a._v("Now that everything is setup and ready to go, you can start your node.")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"Y29zbW92aXNvciBydW4gc3RhcnQK"}}),a._v(" "),o("p",[a._v("You will need some way to keep the process always running. If you're on linux, you can do this by creating a service.")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"c3VkbyB0ZWUgL2V0Yy9zeXN0ZW1kL3N5c3RlbS9wbGFucWQuc2VydmljZSAmZ3Q7IC9kZXYvbnVsbCAmbHQ7Jmx0O0VPRgpbVW5pdF0KRGVzY3JpcHRpb249UGxhbnEgRGFlbW9uCkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldAoKW1NlcnZpY2VdClVzZXI9JFVTRVIKRXhlY1N0YXJ0PSQod2hpY2ggY29zbW92aXNvcikgc3RhcnQKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz0zCkxpbWl0Tk9GSUxFPWluZmluaXR5CgpFbnZpcm9ubWVudD0mcXVvdDtEQUVNT05fSE9NRT0kSE9NRS8ucGxhbnFkJnF1b3Q7CkVudmlyb25tZW50PSZxdW90O0RBRU1PTl9OQU1FPXBsYW5xZCZxdW90OwpFbnZpcm9ubWVudD0mcXVvdDtEQUVNT05fQUxMT1dfRE9XTkxPQURfQklOQVJJRVM9ZmFsc2UmcXVvdDsKRW52aXJvbm1lbnQ9JnF1b3Q7REFFTU9OX1JFU1RBUlRfQUZURVJfVVBHUkFERT10cnVlJnF1b3Q7CgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQKRU9GCg=="}}),a._v(" "),o("p",[a._v("Then update and start the node")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"c3VkbyAtUyBzeXN0ZW1jdGwgZGFlbW9uLXJlbG9hZApzdWRvIC1TIHN5c3RlbWN0bCBlbmFibGUgcGxhbnFkCnN1ZG8gLVMgc3lzdGVtY3RsIHN0YXJ0IHBsYW5xZAo="}}),a._v(" "),o("p",[a._v("You can check the status with:")]),a._v(" "),o("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"c3lzdGVtY3RsIHN0YXR1cyBwbGFucWQK"}})],1)}),[],!1,null,null,null);o.default=s.exports}}]);